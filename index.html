<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - Chat & Certification System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* General Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex; /* Use flexbox for body to center content */
            justify-content: center;
            align-items: center;
            padding: 20px; /* Add some padding around the container */
        }

        /* Main Container Layout */
        .container {
            max-width: 1400px;
            width: 100%; /* Ensure it takes full width up to max-width */
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            grid-template-rows: 80px 1fr;
            grid-template-areas:
                "header header header"
                "sidebar main analytics";
            gap: 20px;
            min-height: calc(100vh - 40px); /* Adjust min-height for body padding */
        }

        /* Shared Card/Panel Styles */
        .header, .sidebar, .main-content, .analytics-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            padding: 25px; /* Default padding */
        }

        /* Header Specific Styles */
        .header {
            grid-area: header;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative; /* Needed for z-index to work in grid context */
            z-index: 10; /* Ensure header is on top of other grid areas */
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Persona Selector Dropdown */
        .persona-selector {
            position: relative;
            flex-shrink: 0; /* Prevent shrinking to ensure dropdown space */
        }

        .persona-dropdown {
            background: white;
            border: 2px solid #e1e5f7;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            user-select: none; /* Prevent text selection */
            white-space: nowrap; /* Prevent text wrapping inside dropdown */
        }

        .persona-dropdown:hover {
            border-color: #667eea;
        }

        .persona-menu {
            position: absolute;
            top: 100%;
            right: 0; /* Position to the right of the parent */
            background: white;
            border: 2px solid #e1e5f7;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            min-width: 220px;
            z-index: 9999; /* Increased z-index to ensure it's on top */
            display: none;
            margin-top: 5px;
            max-height: 300px; /* Limit height for scroll if many personas */
            overflow-y: auto; /* Enable scroll for many personas */
        }

        .persona-menu.show {
            display: block;
        }

        .persona-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .persona-item:last-child {
            border-bottom: none;
        }

        .persona-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .persona-item.admin {
            background: linear-gradient(45deg, rgba(220, 53, 69, 0.1), rgba(255, 193, 7, 0.1));
        }

        .persona-item.admin:hover {
            background: linear-gradient(45deg, rgba(220, 53, 69, 0.2), rgba(255, 193, 7, 0.2));
        }

        .persona-title {
            font-weight: 600;
            font-size: 14px;
        }

        .persona-desc {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .admin-avatar {
            background: linear-gradient(45deg, #dc3545, #ffc107);
        }

        /* Sidebar Navigation */
        .sidebar {
            grid-area: sidebar;
            padding: 25px;
        }

        .sidebar.admin-mode {
            border-left: 4px solid #dc3545;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section-title {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
        }

        .nav-item.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .nav-item.admin-active {
            background: linear-gradient(45deg, #dc3545, #ffc107);
            color: white;
        }

        .nav-item:hover:not(.active):not(.admin-active) {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-item.admin-item:hover:not(.admin-active) {
            background: rgba(220, 53, 69, 0.1);
        }

        /* Main Content Area */
        .main-content {
            grid-area: main;
            display: flex;
            flex-direction: column;
            padding: 30px;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
            max-height: 60vh; /* Adjust max-height to ensure input field is visible */
            min-height: 200px; /* Minimum height for chat area */
            display: flex;
            flex-direction: column;
        }

        .message {
            margin: 10px 0; /* Adjusted margin */
            padding: 15px 20px;
            border-radius: 16px;
            max-width: 80%;
            position: relative;
            word-wrap: break-word; /* Ensure long words wrap */
        }

        .message.user {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 6px;
        }

        .message.ai {
            background: #f8f9ff;
            border: 1px solid #e1e5f7;
            margin-right: auto;
            border-bottom-left-radius: 6px;
        }

        .message-meta {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 8px;
        }

        .kb-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #667eea;
            text-decoration: none;
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .kb-link:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .feedback-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .feedback-btn {
            background: none;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 6px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .feedback-btn:hover {
            background: #f0f0f0;
        }

        .feedback-btn.positive:hover {
            background: #d4edda;
            border-color: #28a745;
            color: #28a745;
        }

        .feedback-btn.negative:hover {
            background: #f8d7da;
            border-color: #dc3545;
            color: #dc3545;
        }

        .chat-input {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            margin-top: auto; /* Push input to bottom */
        }

        .input-field {
            flex: 1;
            min-height: 50px;
            padding: 15px 20px;
            border: 2px solid #e1e5f7;
            border-radius: 25px;
            resize: none;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        /* Analytics Panel */
        .analytics-panel {
            grid-area: analytics;
            padding: 25px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .stat-card {
            background: #f8f9ff;
            border: 1px solid #e1e5f7;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #667eea; /* Default color for user stats */
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .recent-activity {
            margin-top: 25px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            flex-shrink: 0;
        }

        .activity-text {
            font-size: 13px;
            color: #666;
        }

        /* Certification Section (Hidden by default, shown by JS) */
        .certification-section {
            display: none; /* Hidden by default */
            flex-direction: column; /* Use flex for internal layout */
            gap: 20px;
        }

        .certification-section.active {
            display: flex; /* Show when active */
        }

        .cert-card {
            background: #f8f9ff;
            border: 1px solid #e1e5f7;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .cert-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .cert-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .cert-progress {
            background: #e1e5f7;
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .cert-progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .cert-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #666;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge.completed {
            background: #d4edda;
            color: #28a745;
        }

        .badge.in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .badge.expired {
            background: #f8d7da;
            color: #721c24;
        }

        .badge.active-status { /* For user management table status */
            background: #d4edda;
            color: #28a745;
        }
        .badge.away-status { /* For user management table status */
            background: #fff3cd;
            color: #856404;
        }
        .badge.suspended-status { /* For user management table status */
            background: #f8d7da;
            color: #721c24;
        }
        .badge.high-risk {
            background: #f8d7da;
            color: #dc3545;
        }
        .badge.medium-risk {
            background: #fff3cd;
            color: #ffc107;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            margin: 15px 0;
            background: #f8f9ff;
            border: 1px solid #e1e5f7;
            border-radius: 16px;
            max-width: fit-content; /* Adjust width to content */
            border-bottom-left-radius: 6px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Tagging System */
        .tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            display: inline-flex; /* Use inline-flex for proper alignment with input */
            align-items: center;
            white-space: nowrap; /* Prevent tag text from wrapping */
        }

        .tag:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .tag.add-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px dashed #667eea;
        }

        .tag.add-tag:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .tag.editing {
            background: #ffc107;
            color: #000;
        }

        .tag-input {
            background: transparent;
            border: none;
            outline: none;
            color: inherit;
            font-size: 11px;
            padding: 0; /* Remove padding to fit inside tag */
            margin: 0; /* Remove margin */
            min-width: 40px; /* Minimum width for input */
            text-align: center; /* Center text in input */
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none; /* Hidden by default */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            justify-content: space-around; /* Distribute items evenly */
            flex-wrap: wrap; /* Allow items to wrap */
        }

        .mobile-nav-item {
            padding: 10px 15px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-block;
            font-size: 14px;
        }

        .mobile-nav-item.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        /* Admin Dashboard & Content Moderation Specifics */
        .admin-dashboard-grid, .content-moderation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .alert-card {
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid;
            font-size: 13px;
        }
        .alert-card.high-priority { background: #f8d7da; border-color: #dc3545; }
        .alert-card.medium-priority { background: #fff3cd; border-color: #ffc107; }
        .alert-card.info-priority { background: #d1ecf1; border-color: #17a2b8; }

        /* Table Styles for User Management */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9ff;
            border-bottom: 2px solid #e1e5f7;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .table-actions button {
            background: none;
            border: 1px solid #ddd;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
            transition: all 0.2s ease;
        }
        .table-actions button:hover {
            background: #f0f0f0;
        }
        .table-actions button.suspend-btn {
            border-color: #dc3545;
            color: #dc3545;
        }
        .table-actions button.reactivate-btn {
            border-color: #28a745;
            color: #28a745;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            body {
                padding: 10px;
            }
            .container {
                grid-template-columns: 1fr; /* Single column layout */
                grid-template-areas:
                    "header"
                    "mobile-nav" /* New area for mobile nav */
                    "main"
                    "analytics";
                gap: 10px;
                min-height: calc(100vh - 20px); /* Adjust min-height for body padding */
            }
            
            .sidebar {
                display: none; /* Hide sidebar on smaller screens */
            }

            .mobile-nav {
                grid-area: mobile-nav; /* Assign to new area */
                display: flex; /* Show mobile nav */
            }
            
            .header {
                padding: 0 20px;
            }
            
            .main-content,
            .analytics-panel {
                padding: 20px;
            }
            
            .message {
                max-width: 90%;
            }

            .chat-messages {
                max-height: 50vh; /* Adjust for smaller screens */
            }

            .admin-dashboard-grid, .content-moderation-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Smaller min-width for stats */
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 20px;
            }
            .user-info span {
                display: none; /* Hide "Welcome, John Smith" */
            }
            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            .persona-dropdown {
                padding: 6px 12px;
                font-size: 13px;
            }
            .chat-header h2 {
                font-size: 20px;
            }
            .chat-header span {
                font-size: 10px;
            }
            .input-field {
                min-height: 45px;
                padding: 12px 15px;
            }
            .send-btn {
                width: 45px;
                height: 45px;
            }
            .panel-title {
                font-size: 16px;
            }
            .stat-number {
                font-size: 20px;
            }
            .stat-label {
                font-size: 11px;
            }
            .mobile-nav-item {
                padding: 8px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">ü§ñ AI Chat</div>
            <div class="user-info">
                <div class="persona-selector">
                    <div class="persona-dropdown" onclick="togglePersonaMenu(event)">
                        <span id="currentPersona">üë®‚Äçüîß Technician</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="persona-menu" id="personaMenu">
                        <div class="persona-item" onclick="switchPersona('technician', 'üë®‚Äçüîß Technician', 'JS')">
                            <div>
                                <div class="persona-title">üë®‚Äçüîß Technician</div>
                                <div class="persona-desc">Troubleshooting & repairs</div>
                            </div>
                        </div>
                        <div class="persona-item" onclick="switchPersona('sales', 'üíº Sales Rep', 'JS')">
                            <div>
                                <div class="persona-title">üíº Sales Representative</div>
                                <div class="persona-desc">Product info & customer support</div>
                            </div>
                        </div>
                        <div class="persona-item" onclick="switchPersona('trainer', 'üéì Trainer', 'JS')">
                            <div>
                                <div class="persona-title">üéì Trainer</div>
                                <div class="persona-desc">Course materials & assessments</div>
                            </div>
                        </div>
                        <div class="persona-item" onclick="switchPersona('compliance', '‚öñÔ∏è Compliance Officer', 'JS')">
                            <div>
                                <div class="persona-title">‚öñÔ∏è Compliance Officer</div>
                                <div class="persona-desc">Audit & regulatory oversight</div>
                            </div>
                        </div>
                        <div class="persona-item" onclick="switchPersona('manager', 'üëî L&D Manager', 'JS')">
                            <div>
                                <div class="persona-title">üëî L&D Manager</div>
                                <div class="persona-desc">Learning strategy & analytics</div>
                            </div>
                        </div>
                        <hr style="margin: 8px 0; border: none; border-top: 1px solid #eee;">
                        <div class="persona-item admin" onclick="switchPersona('admin', 'üõ°Ô∏è System Admin', 'AD')">
                            <div>
                                <div class="persona-title">üõ°Ô∏è System Administrator</div>
                                <div class="persona-desc">Full system access & control</div>
                            </div>
                        </div>
                        <div class="persona-item admin" onclick="switchPersona('super-admin', '‚ö° Super Admin', 'SA')">
                            <div>
                                <div class="persona-title">‚ö° Super Administrator</div>
                                <div class="persona-desc">Master admin privileges</div>
                            </div>
                        </div>
                    </div>
                </div>
                <span>Welcome, <strong>John Smith</strong></span>
                <div class="user-avatar" id="userAvatar">JS</div>
            </div>
        </header>

        <aside class="sidebar" id="sidebar">
            <nav>
                <div class="nav-section" id="userNavSection">
                    <div class="nav-section-title">My Workspace</div>
                    <div class="nav-item active" onclick="showSection('chat', this)">
                        üí¨ AI Assistant
                    </div>
                    <div class="nav-item" onclick="showSection('certifications', this)">
                        üéì My Certifications
                    </div>
                    <div class="nav-item" onclick="showSection('knowledge', this)">
                        üìö Knowledge Base
                    </div>
                    <div class="nav-item" onclick="showSection('profile', this)">
                        üë§ My Profile
                    </div>
                    <div class="nav-item" onclick="showSection('notifications', this)">
                        üîî Notifications
                    </div>
                </div>

                <div class="nav-section" id="adminNavSection" style="display: none;">
                    <div class="nav-section-title">Admin Panel</div>
                    <div class="nav-item admin-item" onclick="showSection('admin-dashboard', this)">
                        üìä Dashboard
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('chat-analytics', this)">
                        üí¨ Chat Analytics
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('user-management', this)">
                        üë• User Management
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('content-moderation', this)">
                        üõ°Ô∏è Content Moderation
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('ai-training', this)">
                        ü§ñ AI Training
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('system-analytics', this)">
                        üìà System Analytics
                    </div>
                    <div class="nav-item admin-item" onclick="showSection('compliance-audit', this)">
                        ‚öñÔ∏è Compliance Audit
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Support</div>
                    <div class="nav-item" onclick="showSection('help', this)">
                        ‚ùì Help & Support
                    </div>
                    <div class="nav-item" onclick="showSection('settings', this)">
                        ‚öôÔ∏è Settings
                    </div>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Mobile Navigation (visible on smaller screens) -->
            <div class="mobile-nav" id="mobileNav">
                <span class="mobile-nav-item active" onclick="showSection('chat', this)">Chat</span>
                <span class="mobile-nav-item" onclick="showSection('certifications', this)">Certifications</span>
                <span class="mobile-nav-item" onclick="showSection('knowledge', this)">Knowledge</span>
                <span class="mobile-nav-item" onclick="showSection('profile', this)">Profile</span>
                <!-- Admin mobile items can be added here and toggled by JS if needed -->
            </div>

            <!-- Chat Section -->
            <div id="chat-section" class="chat-container active">
                <div class="chat-header">
                    <h2>AI Chat</h2>
                    <span style="font-size: 12px; color: #666;">üü¢ Online ‚Ä¢ Response time: 1.2s avg</span>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- Chat messages will be dynamically loaded here based on persona -->
                </div>

                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                
                <div class="chat-input">
                    <textarea class="input-field" placeholder="Ask me anything about procedures, troubleshooting, or certifications..." rows="1" id="messageInput"></textarea>
                    <button class="send-btn" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>

            <!-- Certifications Section -->
            <div id="certifications-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Your Certifications</h2>
                
                <div class="cert-card">
                    <div class="cert-title">Brake System Certification Level 2</div>
                    <div class="cert-progress">
                        <div class="cert-progress-fill" style="width: 85%"></div>
                    </div>
                    <div class="cert-status">
                        <span>85% Complete</span>
                        <span class="badge in-progress">In Progress</span>
                    </div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Next: Final Assessment ‚Ä¢ Due: Jan 30, 2025</p>
                </div>

                <div class="cert-card">
                    <div class="cert-title">Engine Diagnostics Fundamentals</div>
                    <div class="cert-progress">
                        <div class="cert-progress-fill" style="width: 100%"></div>
                    </div>
                    <div class="cert-status">
                        <span>Completed Dec 15, 2024</span>
                        <span class="badge completed">Certified</span>
                    </div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Valid until: Dec 15, 2026</p>
                </div>

                <div class="cert-card">
                    <div class="cert-title">Safety Protocols Annual Update</div>
                    <div class="cert-progress">
                        <div class="cert-progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="cert-status">
                        <span>Not Started</span>
                        <span class="badge expired">Overdue</span>
                    </div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Due: Jan 1, 2025 ‚Ä¢ ‚ö†Ô∏è Required for compliance</p>
                </div>
            </div>

            <!-- Knowledge Base Section (Placeholder) -->
            <div id="knowledge-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Knowledge Base</h2>
                <p style="color: #666;">Browse articles, guides, and FAQs here.</p>
                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">Featured Articles</div>
                    <ul style="list-style: none; padding: 10px 0;">
                        <li style="padding: 8px 0; border-bottom: 1px dashed #eee;"><a href="#" class="kb-link" style="background: none; padding: 0;">Advanced Engine Diagnostics</a></li>
                        <li style="padding: 8px 0; border-bottom: 1px dashed #eee;"><a href="#" class="kb-link" style="background: none; padding: 0;">Safety Protocol Updates Q3 2024</a></li>
                        <li style="padding: 8px 0;"><a href="#" class="kb-link" style="background: none; padding: 0;">New Product Line Overview 2025</a></li>
                    </ul>
                </div>
            </div>

            <!-- My Profile Section (Placeholder) -->
            <div id="profile-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">My Profile</h2>
                <div class="cert-card">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                        <div class="user-avatar" style="width: 80px; height: 80px; font-size: 30px;">JS</div>
                        <div>
                            <div style="font-size: 24px; font-weight: 700;">John Smith</div>
                            <div style="font-size: 16px; color: #666;" id="profilePersona">Technician</div>
                        </div>
                    </div>
                    <p style="font-size: 14px; color: #666;">Email: john.smith@example.com</p>
                    <p style="font-size: 14px; color: #666;">Employee ID: #78901</p>
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">Completed 12 certifications and 200+ chat interactions.</p>
                    <button style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">Edit Profile</button>
                </div>
            </div>

            <!-- Notifications Section (Placeholder) -->
            <div id="notifications-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Notifications</h2>
                <div class="cert-card">
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 14px; color: #333;">
                            <span style="font-weight: 600;">New Certification Available:</span> Advanced Electrical Systems. <span style="font-size: 11px; color: #999;">2 hours ago</span>
                        </li>
                        <li style="padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 14px; color: #333;">
                            <span style="font-weight: 600;">Reminder:</span> Safety Protocols Annual Update due Jan 1, 2025. <span style="font-size: 11px; color: #999;">1 day ago</span>
                        </li>
                        <li style="padding: 10px 0; font-size: 14px; color: #333;">
                            <span style="font-weight: 600;">Chat Feedback:</span> Your recent response was rated üëç. <span style="font-size: 11px; color: #999;">3 days ago</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Admin Dashboard Section -->
            <div id="admin-dashboard-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Admin Dashboard</h2>
                
                <div class="admin-dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #dc3545;">1,247</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">99.2%</div>
                        <div class="stat-label">System Uptime</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffc107;">23</div>
                        <div class="stat-label">Flagged Responses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #17a2b8;">156</div>
                        <div class="stat-label">Pending Reviews</div>
                    </div>
                </div>

                <div class="cert-card">
                    <div class="cert-title">üö® System Alerts</div>
                    <div style="margin-top: 15px;">
                        <div class="alert-card high-priority">
                            <strong>High Priority:</strong> 15 users with expired safety certifications
                        </div>
                        <div class="alert-card medium-priority">
                            <strong>Medium Priority:</strong> AI confidence below 85% for brake system queries
                        </div>
                        <div class="alert-card info-priority">
                            <strong>Info:</strong> New knowledge base articles pending approval
                        </div>
                    </div>
                </div>

                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">üìä Recent Admin Activity</div>
                    <div style="margin-top: 15px; font-size: 13px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                            <span>Updated AI training data</span>
                            <span style="color: #666;">2 hours ago</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                            <span>Approved 5 knowledge base articles</span>
                            <span style="color: #666;">4 hours ago</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                            <span>Flagged inappropriate response</span>
                            <span style="color: #666;">6 hours ago</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span>Created new certification template</span>
                            <span style="color: #666;">1 day ago</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Analytics Section -->
            <div id="chat-analytics-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Chat Analytics Dashboard</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #667eea;">15,847</div>
                        <div class="stat-label">Total Conversations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">89%</div>
                        <div class="stat-label">Average Satisfaction</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #17a2b8;">2.3s</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffc107;">234</div>
                        <div class="stat-label">Auto-Tagged Queries</div>
                    </div>
                </div>

                <div class="cert-card">
                    <div class="cert-title">üìä Query Categories & Trends</div>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <span>üîß Technical Troubleshooting</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="background: #e1e5f7; height: 8px; width: 100px; border-radius: 4px;">
                                    <div style="background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; width: 45%; border-radius: 4px;"></div>
                                </div>
                                <span style="font-size: 12px; color: #666;">45%</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <span>üìö Certification Questions</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="background: #e1e5f7; height: 8px; width: 100px; border-radius: 4px;">
                                    <div style="background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; width: 28%; border-radius: 4px;"></div>
                                </div>
                                <span style="font-size: 12px; color: #666;">28%</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <span>üìã Policy & Procedures</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="background: #e1e5f7; height: 8px; width: 100px; border-radius: 4px;">
                                    <div style="background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; width: 18%; border-radius: 4px;"></div>
                                </div>
                                <span style="font-size: 12px; color: #666;">18%</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                            <span>‚ùì General Questions</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="background: #e1e5f7; height: 8px; width: 100px; border-radius: 4px;">
                                    <div style="background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; width: 9%; border-radius: 4px;"></div>
                                </div>
                                <span style="font-size: 12px; color: #666;">9%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">üè∑Ô∏è Tag Management & Analysis</div>
                    <div style="margin-top: 15px;">
                        <h4 style="margin-bottom: 10px; font-size: 14px;">Most Used Tags (This Month)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                            <span class="tag">brake-system (342)</span>
                            <span class="tag">engine-diagnostic (289)</span>
                            <span class="tag">safety-protocol (234)</span>
                            <span class="tag">certification (198)</span>
                            <span class="tag">troubleshooting (187)</span>
                            <span class="tag">electrical-system (156)</span>
                            <span class="tag">maintenance (134)</span>
                            <span class="tag">abs (123)</span>
                        </div>
                        
                        <h4 style="margin-bottom: 10px; font-size: 14px;">Untagged Conversations Requiring Review</h4>
                        <div style="font-size: 13px; color: #dc3545;">
                            <div style="padding: 8px; background: #f8d7da; border-radius: 6px; margin: 5px 0;">
                                <strong>23 conversations</strong> need manual tagging review
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Section -->
            <div id="user-management-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">User Management</h2>
                
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <input type="text" placeholder="Search users..." style="flex: 1; min-width: 150px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                    <select style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        <option>All Roles</option>
                        <option>Technicians</option>
                        <option>Sales Reps</option>
                        <option>Trainers</option>
                        <option>Managers</option>
                        <option>Admins</option>
                    </select>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;">+ Add User</button>
                </div>

                <div class="cert-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div class="cert-title">Active Users (1,247)</div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Last Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>John Smith</td>
                                    <td>Technician</td>
                                    <td><span class="badge active-status">Active</span></td>
                                    <td>5 min ago</td>
                                    <td class="table-actions">
                                        <button>Edit</button>
                                        <button class="suspend-btn">Suspend</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Sarah Johnson</td>
                                    <td>Sales Rep</td>
                                    <td><span class="badge away-status">Away</span></td>
                                    <td>2 hours ago</td>
                                    <td class="table-actions">
                                        <button>Edit</button>
                                        <button class="suspend-btn">Suspend</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Mike Wilson</td>
                                    <td>Trainer</td>
                                    <td><span class="badge suspended-status">Suspended</span></td>
                                    <td>3 days ago</td>
                                    <td class="table-actions">
                                        <button class="reactivate-btn">Reactivate</button>
                                        <button>Edit</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Emily White</td>
                                    <td>L&D Manager</td>
                                    <td><span class="badge active-status">Active</span></td>
                                    <td>1 hour ago</td>
                                    <td class="table-actions">
                                        <button>Edit</button>
                                        <button class="suspend-btn">Suspend</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>David Lee</td>
                                    <td>Compliance Officer</td>
                                    <td><span class="badge active-status">Active</span></td>
                                    <td>1 day ago</td>
                                    <td class="table-actions">
                                        <button>Edit</button>
                                        <button class="suspend-btn">Suspend</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Content Moderation Section -->
            <div id="content-moderation-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Content Moderation</h2>
                
                <div class="content-moderation-grid">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #dc3545;">23</div>
                        <div class="stat-label">Flagged Responses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffc107;">156</div>
                        <div class="stat-label">Pending Reviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">342</div>
                        <div class="stat-label">Approved Today</div>
                    </div>
                </div>

                <div class="cert-card">
                    <div class="cert-title">üö© Flagged Responses Queue</div>
                    <div style="margin-top: 15px;">
                        <div style="border: 1px solid #eee; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-weight: 600;">Response ID: #R-4523</span>
                                <span class="badge high-risk">High Risk</span>
                            </div>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;"><strong>User Query:</strong> "How to bypass safety protocols for faster repairs?"</p>
                            <p style="color: #666; font-size: 13px; margin-bottom: 15px;"><strong>AI Response:</strong> "Here are some methods to work more efficiently while maintaining safety..."</p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Approve</button>
                                <button style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Reject</button>
                                <button style="background: #ffc107; color: black; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Edit</button>
                            </div>
                        </div>

                        <div style="border: 1px solid #eee; border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-weight: 600;">Response ID: #R-4522</span>
                                <span class="badge medium-risk">Medium Risk</span>
                            </div>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;"><strong>User Query:</strong> "What are the latest tire pressure specifications?"</p>
                            <p style="color: #666; font-size: 13px; margin-bottom: 15px;"><strong>AI Response:</strong> "Based on 2023 data, recommended tire pressure is 32-35 PSI..." <em>(Confidence: 73%)</em></p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Approve</button>
                                <button style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Reject</button>
                                <button style="background: #ffc107; color: black; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Edit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Training Section (Placeholder) -->
            <div id="ai-training-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">AI Training & Feedback</h2>
                <div class="cert-card">
                    <p style="color: #666; margin-bottom: 15px;">Manage AI model training, review feedback, and improve response accuracy.</p>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;">Train New Model</button>
                    <button style="padding: 10px 20px; background: #f0f0f0; color: #333; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">Review Feedback</button>
                </div>
                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">Feedback Trends</div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Positive feedback: 89% (‚Üë2% last month)</p>
                    <p style="font-size: 13px; color: #666;">Negative feedback: 11% (‚Üì1% last month)</p>
                </div>
            </div>

            <!-- System Analytics Section (Placeholder) -->
            <div id="system-analytics-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">System Analytics</h2>
                <div class="cert-card">
                    <p style="color: #666; margin-bottom: 15px;">Detailed insights into system performance, user engagement, and resource utilization.</p>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer;">Generate Report</button>
                </div>
                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">Server Load</div>
                    <p style="font-size: 13px; color: #666; margin-top: 10px;">Current: 35% ‚Ä¢ Peak: 78%</p>
                </div>
            </div>

            <!-- Compliance Audit Section (Placeholder) -->
            <div id="compliance-audit-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Compliance Audit</h2>
                <div class="cert-card">
                    <p style="color: #666; margin-bottom: 15px;">Access full audit trails, regulatory reports, and compliance documentation.</p>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer;">Run Audit</button>
                </div>
                <div class="cert-card" style="margin-top: 20px;">
                    <div class="cert-title">Recent Audits</div>
                    <ul style="list-style: none; padding: 10px 0;">
                        <li style="padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 13px; color: #333;">Q2 2024 Data Privacy Audit - <span style="color: #28a745;">Passed</span></li>
                        <li style="padding: 8px 0; font-bottom: 1px dashed #eee; font-size: 13px; color: #333;">Annual Security Review 2024 - <span style="color: #ffc107;">Minor Findings</span></li>
                    </ul>
                </div>
            </div>

            <!-- Help & Support Section (Placeholder) -->
            <div id="help-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Help & Support</h2>
                <div class="cert-card">
                    <p style="color: #666; margin-bottom: 15px;">Find answers to common questions or contact support.</p>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer;">Contact Support</button>
                </div>
            </div>

            <!-- Settings Section (Placeholder) -->
            <div id="settings-section" class="certification-section">
                <h2 style="margin-bottom: 20px;">Settings</h2>
                <div class="cert-card">
                    <p style="color: #666; margin-bottom: 15px;">Manage your account settings, preferences, and notifications.</p>
                    <button style="padding: 10px 20px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer;">Account Settings</button>
                </div>
            </div>

        </main>

        <aside class="analytics-panel">
            <h3 class="panel-title" id="analyticsTitle">My Activity</h3>
            
            <div class="stat-card" id="userStats">
                <div class="stat-number">15</div>
                <div class="stat-label">Conversations Today</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number">4</div>
                <div class="stat-label">Certifications Due</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number">92%</div>
                <div class="stat-label">Learning Progress</div>
            </div>

            <div class="recent-activity" id="recentActivity">
                <h4 style="margin-bottom: 15px; font-size: 14px;" id="activityTitle">Recent Activity</h4>
                <!-- Activity items will be dynamically loaded here -->
            </div>

            <div style="margin-top: 25px;" id="personalizedContent">
                <h4 style="margin-bottom: 15px; font-size: 14px;">Recommended for You</h4>
                <!-- Recommended content will be dynamically loaded here -->
            </div>
        </aside>
    </div>

    <script>
        // Data structure for persona-specific chat examples
        const personaChatExamples = {
            'technician': [
                { role: 'ai', text: "Hello! I'm your AI Chat Assistant specialized in technical troubleshooting and repair procedures. How can I help you today?" },
                { role: 'user', text: "I'm having trouble with the brake system diagnostic on a 2023 model. The ABS light stays on even after running the standard diagnostics." },
                { role: 'ai', text: "For persistent ABS lights on 2023 models, try these steps:<br><strong>1.</strong> Check wheel speed sensor connections<br><strong>2.</strong> Verify brake fluid level and quality<br><strong>3.</strong> Run extended diagnostic mode (hold DIAG + RESET for 5 seconds)<br><strong>4.</strong> Check for TSB updates in the system", kbLink: "üìÑ View KB Article: ABS Troubleshooting Guide", tags: ["brake-system", "abs", "diagnostics"] }
            ],
            'sales': [
                { role: 'ai', text: "Hi! I'm here to help with product information, customer inquiries, and sales support. What do you need assistance with?" },
                { role: 'user', text: "Can you give me a quick overview of the new 'EcoDrive' sedan's features and pricing for the premium trim?" },
                { role: 'ai', text: "Certainly! The 2025 EcoDrive Premium trim boasts a 1.5L turbo engine, advanced regenerative braking, and a panoramic sunroof. It includes our latest infotainment system with voice control. The MSRP starts at $32,500. Would you like a detailed spec sheet?", kbLink: "üìÑ View EcoDrive Product Sheet", tags: ["EcoDrive", "pricing", "features"] }
            ],
            'trainer': [
                { role: 'ai', text: "Welcome! I can assist with course development, assessment creation, and training material optimization. How can I support your training efforts?" },
                { role: 'user', text: "I need to create a new certification module on advanced electrical systems. What are the best practices for structuring the content and assessments?" },
                { role: 'ai', text: "For advanced electrical systems, I recommend a modular approach: start with fundamentals, then move to diagnostics, and finally troubleshooting. Incorporate interactive simulations and practical exercises. For assessments, use a mix of multiple-choice, drag-and-drop, and scenario-based questions to test practical application. You can find templates and guidelines in the 'Course Design' section.", kbLink: "üìÑ Course Design Best Practices", tags: ["certification", "course-design", "assessments"] }
            ],
            'compliance': [
                { role: 'ai', text: "Hello! I'm equipped to help with compliance monitoring, audit preparation, and regulatory guidance. What compliance matter can I assist with?" },
                { role: 'user', text: "I need to prepare for the Q3 data privacy audit. Can you provide a checklist of required documents and recent policy updates?" },
                { role: 'ai', text: "To prepare for the Q3 data privacy audit, ensure you have the following:<br><strong>1.</strong> Data Processing Agreements (DPAs) with all third-party vendors.<br><strong>2.</strong> Records of consent for all customer data collected.<br><strong>3.</strong> Latest Privacy Impact Assessments (PIAs) for new features.<br>Recent policy updates include stricter guidelines on data retention, effective July 1st. I can generate a full report.", kbLink: "üìÑ Q3 Audit Checklist & Policy Updates", tags: ["compliance", "audit", "data-privacy"] }
            ],
            'manager': [
                { role: 'ai', text: "Hi! I can provide learning analytics, team performance insights, and strategic training recommendations. How can I support your L&D initiatives?" },
                { role: 'user', text: "I want to see the performance trends for the sales team's product knowledge certification over the last six months." },
                { role: 'ai', text: "I can pull that report for you. Over the last six months, the sales team's average score on product knowledge certifications has increased by 15%. There's a slight dip in Q2, likely due to the new product launch. I recommend targeted training on the new product line to address this. Would you like a detailed breakdown by individual or region?", kbLink: "üìä Sales Team Performance Report", tags: ["performance", "analytics", "L&D"] }
            ],
            'admin': [
                { role: 'ai', text: "System Administrator mode activated. I can help with user management, system configuration, and advanced analytics. What administrative task do you need assistance with?" },
                { role: 'user', text: "I need to review recent flagged responses and check system uptime for the past 24 hours." },
                { role: 'ai', text: "Understood. There are 23 flagged responses pending review, with 5 marked as high priority. System uptime for the last 24 hours is 99.8%, with a minor service interruption at 03:15 AM for 5 minutes due to a routine server restart. You can access detailed logs in the System Analytics section.", kbLink: "‚öôÔ∏è System Logs & Flagged Content", tags: ["admin", "system-status", "moderation"] }
            ],
            'super-admin': [
                { role: 'ai', text: "Super Administrator privileges enabled. Full system access granted. I can assist with any administrative, technical, or strategic system requirements." },
                { role: 'user', text: "I need to deploy a critical security patch across all user accounts and review the global system access logs for anomalies." },
                { role: 'ai', text: "The critical security patch (Patch ID: SEC-2025-001) is scheduled for deployment tonight at 02:00 AM UTC. All user sessions will be briefly interrupted. I've initiated a deep scan of global system access logs for anomalies; initial findings show no unusual activity in the last 72 hours. A full report will be available in the Compliance Audit section within 30 minutes. Is there anything else?" , tags: ["super-admin", "security", "audit"] }
            ]
        };

        // Data structure for persona-specific analytics activities and recommendations
        const personaAnalyticsData = {
            'technician': {
                stats: { conversations: 15, certsDue: 4, learningProgress: '92%' },
                activity: [
                    { text: "Completed brake diagnostic chat" },
                    { text: "Tagged conversation: brake-system" },
                    { text: "Accessed KB article #B-2045" },
                    { text: "Started certification assessment" }
                ],
                recommendations: [
                    "üéì Complete Brake Certification Level 2",
                    "üìö New: 2025 Safety Updates",
                    "üîß Engine Diagnostic Tools Guide"
                ]
            },
            'sales': {
                stats: { conversations: 22, certsDue: 2, learningProgress: '85%' },
                activity: [
                    { text: "Reviewed EcoDrive product sheet" },
                    { text: "Chatted with customer about pricing" },
                    { text: "Completed 'Sales Pitch Mastery' module" },
                    { text: "Accessed CRM for customer history" }
                ],
                recommendations: [
                    "üìà Master Negotiation Techniques course",
                    "üìö New: Competitor Analysis Report",
                    "üíº Product Feature Deep Dive: EcoBoost"
                ]
            },
            'trainer': {
                stats: { conversations: 8, certsDue: 1, learningProgress: '98%' },
                activity: [
                    { text: "Updated 'Electrical Systems' course" },
                    { text: "Reviewed trainee assessment results" },
                    { text: "Uploaded new training video: 'Hydraulics Basics'" },
                    { text: "Responded to course feedback" }
                ],
                recommendations: [
                    "üìù Create new 'Advanced Diagnostics' module",
                    "üìä Analyze trainee performance trends",
                    "üìö Instructional Design Best Practices"
                ]
            },
            'compliance': {
                stats: { conversations: 7, certsDue: 0, learningProgress: '100%' },
                activity: [
                    { text: "Reviewed Q3 data privacy audit checklist" },
                    { text: "Accessed regulatory guidelines database" },
                    { text: "Flagged a potentially non-compliant response" },
                    { text: "Prepared monthly compliance report" }
                ],
                recommendations: [
                    "‚öñÔ∏è Upcoming Regulatory Changes webinar",
                    "üìö Data Security & GDPR Compliance course",
                    "üìã Internal Audit Procedures review"
                ]
            },
            'manager': {
                stats: { conversations: 10, certsDue: 0, learningProgress: '95%' },
                activity: [
                    { text: "Analyzed sales team's certification data" },
                    { text: "Approved new training budget request" },
                    { text: "Reviewed L&D strategy document" },
                    { text: "Met with HR about new hire onboarding" }
                ],
                recommendations: [
                    "üìä Advanced L&D Analytics workshop",
                    "üìà Talent Development & Retention strategies",
                    "üëî Leadership & Team Management course"
                ]
            },
            'admin': {
                stats: { activeUsers: 1247, uptime: '99.2%', flaggedResponses: 23, pendingReviews: 156 },
                activity: [
                    { text: "Updated AI training data" },
                    { text: "Approved 5 knowledge base articles" },
                    { text: "Flagged inappropriate response" },
                    { text: "Created new certification template" }
                ],
                recommendations: [
                    "‚ö†Ô∏è 15 expired certifications need attention",
                    "üîç 23 responses flagged for review",
                    "üìà System performance: 99.2% uptime"
                ]
            },
            'super-admin': {
                stats: { activeUsers: 1500, uptime: '99.9%', flaggedResponses: 5, pendingReviews: 10 },
                activity: [
                    { text: "Deployed critical security patch" },
                    { text: "Reviewed global system access logs" },
                    { text: "Configured new server instance" },
                    { text: "Performed quarterly system backup" }
                ],
                recommendations: [
                    "‚ö° Review master audit trails for Q3",
                    "üõ°Ô∏è Plan next-gen security enhancements",
                    "üìä Global system performance optimization report"
                ]
            }
        };


        // Function to toggle the persona selection menu
        function togglePersonaMenu(event) {
            // Stop event propagation to prevent the document click listener from immediately closing the menu
            event.stopPropagation(); 
            const menu = document.getElementById('personaMenu');
            menu.classList.toggle('show');
        }

        // Function to switch the active persona
        function switchPersona(persona, displayName, initials) {
            // Update current persona display in header
            document.getElementById('currentPersona').textContent = displayName;
            
            // Update user avatar initials and styling
            const avatar = document.getElementById('userAvatar');
            avatar.textContent = initials;
            if (persona === 'admin' || persona === 'super-admin') {
                avatar.classList.add('admin-avatar');
            } else {
                avatar.classList.remove('admin-avatar');
            }
            
            // Update sidebar and navigation visibility based on persona type
            const sidebar = document.getElementById('sidebar');
            const userNavSection = document.getElementById('userNavSection');
            const adminNavSection = document.getElementById('adminNavSection');
            const mobileNav = document.getElementById('mobileNav');

            // Clear existing mobile nav items and rebuild based on role
            mobileNav.innerHTML = '';

            if (persona === 'admin' || persona === 'super-admin') {
                // Admin view: Show admin sidebar section, add admin-mode class
                sidebar.classList.add('admin-mode');
                adminNavSection.style.display = 'block';
                userNavSection.style.display = 'block'; // Keep user features available for admins

                // Add mobile nav items for admin sections
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('admin-dashboard', this)">Dashboard</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('chat-analytics', this)">Chat Analytics</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('user-management', this)">Users</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('content-moderation', this)">Moderation</span>`;
                // Optionally add more admin mobile nav items
                
                // Show admin dashboard by default for admins
                setTimeout(() => {
                    showSection('admin-dashboard', document.querySelector('[onclick="showSection(\'admin-dashboard\', this)"]'));
                }, 10); // Small delay to ensure DOM updates
            } else {
                // User view: Hide admin sidebar section, remove admin-mode class
                sidebar.classList.remove('admin-mode');
                adminNavSection.style.display = 'none';
                userNavSection.style.display = 'block';

                // Add mobile nav items for user sections
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('chat', this)">Chat</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('certifications', this)">Certifications</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('knowledge', this)">Knowledge</span>`;
                mobileNav.innerHTML += `<span class="mobile-nav-item" onclick="showSection('profile', this)">Profile</span>`;
                // Optionally add more user mobile nav items

                // Show chat by default for users
                setTimeout(() => {
                    showSection('chat', document.querySelector('[onclick="showSection(\'chat\', this)"]'));
                }, 10); // Small delay to ensure DOM updates
            }
            
            // Update chat welcome message and examples based on persona
            updateChatForPersona(persona);
            
            // Update analytics panel content based on role
            updateAnalyticsForRole(persona);

            // Update profile persona display
            document.getElementById('profilePersona').textContent = displayName.split(' ')[1] || displayName; // Extract role name

            // Close persona dropdown menu
            document.getElementById('personaMenu').classList.remove('show');
        }

        // Function to update the AI's welcome message and chat examples based on persona
        function updateChatForPersona(persona) {
            const chatMessagesContainer = document.getElementById('chatMessages');
            chatMessagesContainer.innerHTML = ''; // Clear existing messages

            const messages = personaChatExamples[persona] || personaChatExamples['technician']; // Default to technician if persona not found

            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.role}`;
                
                let content = `<p>${msg.text}</p>`;
                if (msg.kbLink) {
                    content += `<a href="#" class="kb-link">${msg.kbLink}</a>`;
                }
                if (msg.tags && msg.tags.length > 0) {
                    content += `<div class="message-tags" style="margin: 10px 0; display: flex; flex-wrap: wrap; gap: 6px;">`;
                    msg.tags.forEach(tag => {
                        content += `<span class="tag" onclick="editTag(this)">${tag}</span>`;
                    });
                    content += `<span class="tag add-tag" onclick="addNewTag(this)">+ Add Tag</span>`;
                    content += `</div>`;
                } else if (msg.role === 'ai') { // Only add "Add Tag" for AI responses if no tags exist
                     content += `<div class="message-tags" style="margin: 10px 0; display: flex; flex-wrap: wrap; gap: 6px;">`;
                     content += `<span class="tag add-tag" onclick="addNewTag(this)">+ Add Tag</span>`;
                     content += `</div>`;
                }

                // Add feedback buttons only for AI messages
                if (msg.role === 'ai') {
                    content += `
                        <div class="feedback-buttons">
                            <button class="feedback-btn positive" onclick="giveFeedback(this, 'positive')">üëç</button>
                            <button class="feedback-btn negative" onclick="giveFeedback(this, 'negative')">üëé</button>
                            <button class="feedback-btn" onclick="flagForReview(this)">üö© Flag</button>
                        </div>
                    `;
                }

                const sender = msg.role === 'user' ? 'You' : 'AI Assistant';
                const confidence = msg.confidence ? ` ‚Ä¢ Confidence: ${msg.confidence}%` : '';
                const autoTagged = msg.autoTagged ? ' ‚Ä¢ Auto-tagged' : '';
                content += `<div class="message-meta">${sender} ‚Ä¢ Just now${confidence}${autoTagged}</div>`;

                messageDiv.innerHTML = content;
                chatMessagesContainer.appendChild(messageDiv);
            });

            // Scroll to the bottom of the chat after loading messages
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }

        // Function to update the analytics panel based on the current role
        function updateAnalyticsForRole(persona) {
            const analyticsTitle = document.getElementById('analyticsTitle');
            const userStats = document.getElementById('userStats');
            const activityTitle = document.getElementById('activityTitle');
            const personalizedContent = document.getElementById('personalizedContent');
            const analyticsPanel = document.querySelector('.analytics-panel'); // Get the analytics panel element
            const recentActivityContainer = document.getElementById('recentActivity');

            const data = personaAnalyticsData[persona] || personaAnalyticsData['technician']; // Default to technician

            // Update stats section
            if (persona === 'admin' || persona === 'super-admin') {
                analyticsPanel.style.display = 'block'; // Show the panel
                analyticsTitle.textContent = 'System Overview';
                userStats.innerHTML = `
                    <div class="stat-number" style="color: #dc3545;">${data.stats.activeUsers}</div>
                    <div class="stat-label">Active Users</div>
                `;
                // For admin/super-admin, populate other stats cards if they exist
                // For simplicity, hardcoding for now, but could be dynamic too
                userStats.nextElementSibling.innerHTML = `<div class="stat-number" style="color: #28a745;">${data.stats.uptime}</div><div class="stat-label">System Uptime</div>`;
                userStats.nextElementSibling.nextElementSibling.innerHTML = `<div class="stat-number" style="color: #ffc107;">${data.stats.flaggedResponses}</div><div class="stat-label">Flagged Responses</div>`;
                userStats.nextElementSibling.nextElementSibling.nextElementSibling.innerHTML = `<div class="stat-number" style="color: #17a2b8;">${data.stats.pendingReviews}</div><div class="stat-label">Pending Reviews</div>`;

            } else {
                analyticsPanel.style.display = 'block'; // Ensure it's visible for user roles too
                analyticsTitle.textContent = 'My Activity';
                userStats.innerHTML = `
                    <div class="stat-number">${data.stats.conversations}</div>
                    <div class="stat-label">Conversations Today</div>
                `;
                userStats.querySelector('.stat-number').style.color = '#667eea'; // Reset color for user stats
                userStats.nextElementSibling.innerHTML = `<div class="stat-number">${data.stats.certsDue}</div><div class="stat-label">Certifications Due</div>`;
                userStats.nextElementSibling.nextElementSibling.innerHTML = `<div class="stat-number">${data.stats.learningProgress}</div><div class="stat-label">Learning Progress</div>`;
            }

            // Update Recent Activity section
            activityTitle.textContent = (persona === 'admin' || persona === 'super-admin') ? 'System Activity' : 'Recent Activity';
            recentActivityContainer.innerHTML = `<h4 style="margin-bottom: 15px; font-size: 14px;" id="activityTitle">${activityTitle.textContent}</h4>`; // Re-add title
            data.activity.forEach(item => {
                const activityItemDiv = document.createElement('div');
                activityItemDiv.className = 'activity-item';
                activityItemDiv.innerHTML = `
                    <div class="activity-dot"></div>
                    <div class="activity-text">${item.text}</div>
                `;
                recentActivityContainer.appendChild(activityItemDiv);
            });

            // Update Recommended for You / Admin Alerts section
            personalizedContent.innerHTML = `<h4 style="margin-bottom: 15px; font-size: 14px;">${(persona === 'admin' || persona === 'super-admin') ? 'Admin Alerts' : 'Recommended for You'}</h4>`;
            const recList = document.createElement('div');
            recList.style.fontSize = '12px';
            recList.style.color = '#666';
            data.recommendations.forEach(rec => {
                const recItemDiv = document.createElement('div');
                recItemDiv.style.margin = '8px 0';
                recItemDiv.style.padding = '8px';
                recItemDiv.style.borderRadius = '6px';
                if (persona === 'admin' || persona === 'super-admin') {
                    recItemDiv.style.background = 'rgba(220, 53, 69, 0.1)'; // Admin alert background
                } else {
                    recItemDiv.style.background = 'rgba(102, 126, 234, 0.1)'; // User recommendation background
                }
                recItemDiv.innerHTML = rec; // Content can include HTML for icons/badges
                personalizedContent.appendChild(recItemDiv);
            });
        }

        // Function to handle sending a message in the chat
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                
                // Create and append user message
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `
                    <p>${message}</p>
                    <div class="message-meta">You ‚Ä¢ Just now</div>
                `;
                chatMessages.appendChild(userMessage);
                
                // Show typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                typingIndicator.classList.add('show');
                
                // Simulate AI response after a delay
                setTimeout(() => {
                    typingIndicator.classList.remove('show');
                    
                    const aiMessage = document.createElement('div');
                    aiMessage.className = 'message ai';
                    aiMessage.innerHTML = `
                        <p>I understand you're asking about "${message}". Let me provide you with the relevant information and procedures.</p>
                        <a href="#" class="kb-link">üìÑ View Related KB Articles</a>
                        <div class="message-tags" style="margin: 10px 0; display: flex; flex-wrap: wrap; gap: 6px;">
                            <span class="tag add-tag" onclick="addNewTag(this)">+ Add Tag</span>
                        </div>
                        <div class="feedback-buttons">
                            <button class="feedback-btn positive" onclick="giveFeedback(this, 'positive')">üëç</button>
                            <button class="feedback-btn negative" onclick="giveFeedback(this, 'negative')">üëé</button>
                            <button class="feedback-btn" onclick="flagForReview(this)">üö© Flag</button>
                        </div>
                        <div class="message-meta">AI Assistant ‚Ä¢ Just now ‚Ä¢ Confidence: 91% ‚Ä¢ Auto-tagged</div>
                    `;
                    chatMessages.appendChild(aiMessage);
                    // Scroll to the bottom of the chat
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500); // Simulate network delay
                
                // Clear input field and reset its height
                input.value = '';
                input.style.height = 'auto'; // Reset height
                // Scroll to the bottom of the chat after user message is added
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Function to handle inline editing of tags
        function editTag(tagElement) {
            // Prevent editing the "+ Add Tag" button
            if (tagElement.classList.contains('add-tag')) return;
            
            const originalText = tagElement.textContent.replace(/\s*\((\d+)\)\s*$/, ''); // Remove count for editing
            tagElement.classList.add('editing');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tag-input';
            input.value = originalText;
            input.style.width = Math.max(60, originalText.length * 8) + 'px'; // Adjust width dynamically
            
            tagElement.textContent = ''; // Clear original text
            tagElement.appendChild(input); // Append input field
            input.focus(); // Focus the input
            input.select(); // Select all text in the input

            // Function to save the edited tag
            function saveTag() {
                const newText = input.value.trim();
                if (newText) {
                    tagElement.textContent = newText;
                    // Re-add event listener for future edits
                    tagElement.onclick = function() { editTag(this); };
                } else {
                    // If new text is empty, remove the tag (unless it was the original tag with count)
                    if (!originalText.match(/\(\d+\)$/)) { // Only remove if it wasn't an analytics tag
                        tagElement.remove();
                    } else {
                        tagElement.textContent = originalText; // Revert if it was an analytics tag
                    }
                }
                tagElement.classList.remove('editing');
            }
            
            // Event listeners for saving the tag
            input.addEventListener('blur', saveTag);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveTag();
                }
            });
            
            // Dynamic width adjustment for input field
            input.addEventListener('input', function() {
                input.style.width = Math.max(60, input.value.length * 8) + 'px';
            });
        }

        // Function to add a new tag
        function addNewTag(addTagElement) {
            const container = addTagElement.parentElement;
            
            const newTag = document.createElement('span');
            newTag.className = 'tag';
            newTag.textContent = 'new-tag'; // Default text for new tag
            newTag.onclick = function() { editTag(this); }; // Assign edit function
            
            container.insertBefore(newTag, addTagElement); // Insert before the "+ Add Tag" button
            
            // Immediately activate editing for the newly created tag
            setTimeout(() => editTag(newTag), 10);
        }

        // Function to handle feedback (thumbs up/down)
        function giveFeedback(button, type) {
            // Reset all feedback buttons for this message
            const feedbackButtons = button.parentElement.querySelectorAll('.feedback-btn');
            feedbackButtons.forEach(btn => {
                btn.style.background = '';
                btn.style.borderColor = '';
                btn.style.color = '';
                if (btn.textContent.includes('Thanks!')) btn.innerHTML = 'üëç';
                if (btn.textContent.includes('Noted')) btn.innerHTML = 'üëé';
            });

            // Apply selected feedback style
            button.style.background = type === 'positive' ? '#d4edda' : '#f8d7da';
            button.style.borderColor = type === 'positive' ? '#28a745' : '#dc3545';
            button.style.color = type === 'positive' ? '#28a745' : '#dc3545';
            button.innerHTML = type === 'positive' ? 'üëç Thanks!' : 'üëé Noted';
        }

        // Function to flag a response for review
        function flagForReview(button) {
            button.style.background = '#ffc107';
            button.style.color = '#000';
            button.innerHTML = 'üö© Flagged';
            button.disabled = true; // Disable button after flagging
            // In a real application, this would send data to a backend for review
        }

        // Function to show/hide main content sections and update navigation active states
        function showSection(sectionId, clickedElement) {
            // Hide all main sections
            const sections = document.querySelectorAll('.main-content > div');
            sections.forEach(element => {
                element.style.display = 'none';
                element.classList.remove('active');
            });
            
            // Show the selected section
            const sectionElement = document.getElementById(sectionId + '-section');
            if (sectionElement) {
                if (sectionId === 'chat') {
                    sectionElement.style.display = 'flex'; // Chat container needs flex
                } else {
                    sectionElement.style.display = 'block';
                }
                sectionElement.classList.add('active');
            }
            
            // Update navigation active states for both sidebar and mobile nav
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.classList.remove('active', 'admin-active');
            });
            
            // Set the clicked element as active
            if (clickedElement) {
                const isAdminItem = clickedElement.classList.contains('admin-item');
                clickedElement.classList.add(isAdminItem ? 'admin-active' : 'active');

                // Also update the corresponding mobile nav item if it exists
                const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
                mobileNavItems.forEach(item => {
                    if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`showSection('${sectionId}'`)) {
                        item.classList.add('active');
                    }
                });
            }
        }

        // Auto-resize textarea based on content
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto'; // Reset height to recalculate
            this.style.height = Math.min(this.scrollHeight, 120) + 'px'; // Max height 120px
        });

        // Send message on Enter key (prevent new line on Enter)
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) { // Check for Enter key without Shift
                e.preventDefault(); // Prevent default Enter behavior (new line)
                sendMessage();
            }
        });

        // Close persona menu when clicking outside of it
        document.addEventListener('click', function(event) {
            const personaSelector = document.querySelector('.persona-selector');
            const personaMenu = document.getElementById('personaMenu');
            
            // If the click is outside the persona selector, hide the menu
            if (!personaSelector.contains(event.target)) {
                personaMenu.classList.remove('show');
            }
        });

        // Initialize the application when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial persona to 'technician' and update UI
            switchPersona('technician', 'üë®‚Äçüîß Technician', 'JS');
            // Ensure the chat section is displayed and active on load
            showSection('chat', document.querySelector('[onclick="showSection(\'chat\', this)"]'));
        });
    </script>
</body> 
</html>
